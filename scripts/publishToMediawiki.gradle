//tag::publishToMediawiki[]
task publishToMediawiki(
        description: 'Publish contents as mediawiki to Mediawiki',
        group: 'docToolchain'
) {

    doLast {
        def configFile = new File(docDir, mainConfigFile)
        def config = new ConfigSlurper().parse(configFile.text)

        Map connParams = [
                api: config.mediawiki.api,
                user: config.mediawiki.user,
                password: config.mediawiki.password
        ]

        Map params = [
                extension: config.mediawiki.extension,
                imageExtensions: config.mediawiki.imageExtensions,
                context: config.mediawiki.context,
                page: config.mediawiki.page
        ]

        File sourceFolder = new File("${targetDir}/mw")
        exec {
            commandLine 'python3', "${docDir}/bin/uploadAll.py", '-v', "-u", "${connParams.api}", "-b", "${sourceFolder}", "-e", "${params.extension}", "-i", "${params.imageExtensions}", "-c", "${params.context}", "-a", "${params.page}", "-l", "${connParams.user}", "-p", "${connParams.password}"
        }
    }
}
//end::publishToMediawiki[]
